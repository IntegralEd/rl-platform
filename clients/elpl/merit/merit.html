<!DOCTYPE html>
<!-- Deploy: 2024-04-03 -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Merit - Student progress tracking and feedback system by Recursive Learning">
    <meta name="theme-color" content="#c6123f">
    <title>Merit - Recursive Learning</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/clients/elpl/assets/images/client-elpl-favicon.ico">
    
    <!-- Required client scripts -->
    <!-- <script type="module" src="/shared/assets/js/client-component-loader.js"></script> --> <!-- File does not exist -->
    <!-- <script type="module" src="/shared/assets/js/client-auth.js"></script> --> <!-- Commented out for MVP testing -->
    <!-- <script type="module" src="/shared/assets/js/client-router.js"></script> --> <!-- File does not exist -->
    
    <!-- Base variables and custom styles -->
    <link rel="stylesheet" href="/clients/elpl/assets/css/client-elpl-variables.css">
    <link rel="stylesheet" href="/clients/elpl/assets/css/client-elpl.css">
    <link rel="stylesheet" href="assets/css/client-merit-chat.css"> <!-- Correct relative path -->
    
    <!-- Merit specific logic -->
    <script type="module" src="assets/js/client-merit-logic.js"></script> <!-- Correct relative path -->
    
    <!-- Preheader data span -->
    <span id="header-span" style="display:none" 
        data-user-email=""
        data-user-name=""
        data-user-id=""
        data-access-level=""
        data-last-login="">
    </span>

    <script>
        // Initialize version display
        document.addEventListener('DOMContentLoaded', () => {
            const versionDisplay = document.querySelector('.version-display');
            if (versionDisplay) {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                versionDisplay.textContent = `v1.0.0 (${hours}:${minutes})`; // Consider updating version source later
            }
        });
    </script>

    <style>
        :root {
            /* Use ELPL-specific variables */
            --elpl-header-height: 60px;
            --elpl-footer-height: 80px;
            --elpl-primary: #c6123f;
            --elpl-secondary: #211651;
            --elpl-tertiary: #ffa409;
            --elpl-bg: #ffffff;
            --elpl-text: #2c3e50;
            --elpl-border: #e1e4e8;
            --elpl-content-width: 1200px;
            --elpl-card-padding: 1.5rem;
            --elpl-icon-size: 48px;
            --elpl-border-radius: 12px;
        }

        .client-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: var(--elpl-bg);
        }

        .client-header {
            height: var(--elpl-header-height);
            background: var(--elpl-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .client-content {
            flex: 1;
            display: flex; /* Changed from grid in original paste */
            padding: 1rem;
            gap: 1rem;
            max-width: var(--elpl-content-width);
            margin: 0 auto;
            width: 100%;
            position: relative; /* Added for sidebar toggle positioning */
        }

        .sidebar { /* Renamed from client-nav in original */
            width: 20%; /* Adjusted from 200px */
            min-width: 200px; /* Added */
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease; /* Added transition */
            overflow: hidden; /* Added */
            display: flex; /* Added */
            flex-direction: column; /* Added */
        }
        
        .sidebar.expanded {
            width: 20%; /* Ensure expanded state is correct */
             opacity: 1; /* Added */
             visibility: visible; /* Added */
        }

        .sidebar.collapsed {
            width: 0;
            padding: 0;
            min-width: 0; /* Added */
            border: none; /* Added */
            box-shadow: none; /* Added */
             opacity: 0; /* Added */
             visibility: hidden; /* Added */
        }
        
        .sidebar-content { /* Added wrapper */
             width: 100%;
             height: 100%;
             display: flex;
             flex-direction: column;
             opacity: 1; /* Added */
            transition: opacity 0.3s ease; /* Added */
        }
        
         .sidebar.collapsed .sidebar-content { /* Added */
             opacity: 0;
        }

        .sidebar-nav { /* Added wrapper */
            flex: 1;
        }

        .sidebar-nav a, .nav-link { /* Merged styles */
            display: block;
            padding: 15px 20px; /* Adjusted padding */
            color: var(--elpl-text);
            text-decoration: none;
            border-radius: var(--elpl-border-radius); /* Use variable */
            margin-bottom: 5px; /* Adjusted margin */
            transition: all 0.2s ease; /* Use 'all' */
            cursor: pointer;
        }

        .sidebar-nav a:hover, .nav-link:hover {
             background: rgba(198, 18, 63, 0.1); /* Adjusted hover */
        }
        
        .sidebar-nav a.active, .nav-link.active {
            background: var(--elpl-primary);
            color: white;
        }

        .sidebar-toggle { /* Styles added */
            position: absolute; /* Changed from relative */
            left: calc(20% - 20px); /* Position based on sidebar */
            top: 50%;
            transform: translateY(-50%);
            width: 40px; /* Larger touch target */
            height: 40px; /* Larger touch target */
            border-radius: 50%;
            background: var(--elpl-primary);
            border: none;
            color: white; /* Added color */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100; /* Ensure it's above content */
            transition: left 0.3s ease;
        }

        .toggle-icon { /* Added */
            transition: transform 0.3s ease;
        }

        /* Style adjustments for when sidebar is collapsed */
         .client-content.sidebar-collapsed { /* Target parent */
             /* No grid changes needed as using flex */
         }

        .client-content.sidebar-collapsed .sidebar-toggle { /* Adjust toggle position */
            left: 0px; /* Move to edge */
        }
        
         .client-content.sidebar-collapsed .toggle-icon { /* Rotate icon */
             transform: rotate(180deg); /* Point inwards */
         }


        .content-area {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-y: auto; /* Allow content scrolling */
        }

        .client-footer {
            height: var(--elpl-footer-height);
            background: var(--elpl-primary);
            /* margin-top: auto; */ /* Removed as it's fixed */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex; /* Added */
            align-items: center; /* Added */
            justify-content: center; /* Added */
             padding: 0 20px; /* Added padding like playbar/chatbar */
             box-shadow: 0 -2px 6px rgba(0,0,0,0.1); /* Added shadow */
        }

        .footer-content { /* Container inside footer */
             /* max-width: var(--elpl-content-width); */ /* Removed, let playbar/chatbar handle width */
             /* margin: 0 auto; */ /* Removed */
             height: 100%;
             /* padding: 0 1rem; */ /* Removed */
             display: flex;
             align-items: center;
             /* justify-content: center; */ /* Removed */
             width: 100%; /* Added */
             max-width: 800px; /* Added max-width similar to chat */
        }
        
         /* Keep playbar/chatbar styles from original */
         .playbar, .chatbar {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Align button right */
            /* padding: 0 20px; */ /* Removed, padding on footer */
        }

        .chatbar {
             justify-content: center; /* Center chat input */
        }

        .chat-input-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
            /* max-width: 800px; */ /* Let footer-content handle max-width */
            background: white;
            border-radius: 8px;
            padding: 0.5rem;
            /* margin: 0.5rem; */ /* Removed margin */
        }

        .chat-input {
            flex: 1;
            border: none;
            padding: 0.5rem;
            font-size: 1rem;
            resize: none;
            background: transparent;
            min-height: 36px; /* Added min-height */
        }

        .chat-input:focus {
            outline: none;
        }

        .send-button, .next-button { /* Merged styles */
             width: 60px; /* Larger */
             height: 60px; /* Larger */
             border-radius: 50%; /* Circular */
             background: var(--elpl-secondary); /* Use secondary for contrast */
             border: none;
             color: white;
             display: flex;
             align-items: center;
             justify-content: center;
             cursor: pointer;
             padding: 5px; /* Reset padding */
             transition: background 0.2s ease;
             flex-shrink: 0; /* Prevent shrinking */
        }
        
         .send-button:hover, .next-button:hover:not(:disabled) { /* Added hover */
            background: #3a2c7e; /* Darken secondary */
        }
        
         .next-button:disabled { /* Style disabled */
            background: var(--elpl-border);
            cursor: not-allowed;
             opacity: 0.7; /* Added opacity */
        }

        .button-icon { /* Style icons */
             width: 30px; /* Larger icon */
             height: 30px; /* Larger icon */
        }

        [hidden] {
            display: none !important;
        }
        
         /* Form styles from original */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--elpl-text);
            font-weight: 500;
        }
        
         .select-wrapper {
            position: relative;
            width: 100%;
        }

        .select-wrapper::after {
            content: "▼";
            color: var(--elpl-primary);
            font-size: 24px;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            padding-right: 10px;
        }

        .form-control {
            width: 100%;
            padding: 12px; /* Adjusted padding */
            border: 1px solid var(--elpl-border); /* Adjusted border */
            border-radius: var(--elpl-border-radius); /* Use variable */
            font-size: 16px; /* Adjusted font size */
            appearance: none;
            background: white;
            cursor: pointer;
             padding-right: 40px; /* Ensure space for caret */
        }
        
         .form-control:focus { /* Added focus style */
            outline: none;
            border-color: var(--elpl-primary);
            box-shadow: 0 0 0 2px rgba(198, 18, 63, 0.1);
        }

        /* Loading State (simplified) */
        .loading-overlay {
            position: fixed; /* Changed to fixed */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.8); /* Slightly less opaque */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
             flex-direction: column; /* Added */
             gap: 1rem; /* Added */
             color: var(--elpl-secondary); /* Added */
             font-size: 1.2rem; /* Added */
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(33, 22, 81, 0.2); /* Lighter border */
            border-top: 4px solid var(--elpl-secondary); /* Use secondary */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error States (simplified) */
        .error-message {
            color: var(--elpl-primary); /* Use primary for error */
            font-size: 0.9rem; /* Smaller */
            margin-top: 4px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .client-header { /* Adjust header padding */
                 padding: 0 1rem;
            }
           
            .client-content {
                /* flex-direction: column; */ /* Keep sidebar for now */
                 padding: 0.5rem; /* Reduce padding */
                 gap: 0.5rem; /* Reduce gap */
            }

            .sidebar { /* Make sidebar overlay */
                 position: fixed;
                 left: 0;
                 top: var(--elpl-header-height);
                 bottom: var(--elpl-footer-height);
                 height: auto; /* Let it fill space */
                 z-index: 200; /* Above content */
                 transform: translateX(-100%);
                 border-radius: 0 8px 8px 0; /* Round outer corner */
                 width: 250px; /* Fixed width overlay */
                 min-width: 250px; /* Fixed width overlay */
            }
             .sidebar.expanded { /* Slide in */
                 transform: translateX(0);
            }
             .sidebar.collapsed { /* Slide out */
                 transform: translateX(-100%);
                 /* Keep padding/opacity 0 from base collapsed */
            }
            
             .content-area {
                 padding: 1rem; /* Reduce padding */
            }
            
            .sidebar-toggle { /* Reposition toggle */
                 position: fixed; /* Fixed position */
                 top: calc(var(--elpl-header-height) + 10px); /* Below header */
                 left: 10px; /* Near edge */
                 background: var(--elpl-secondary); /* Different color? */
                 z-index: 210; /* Above sidebar */
                 transition: transform 0.3s ease; /* Add transition */
            }
            
             .client-content.sidebar-collapsed .sidebar-toggle { /* Adjust toggle position when closed */
                 left: 10px; /* Keep near edge */
                 transform: rotate(0deg); /* Icon rotation managed separately */
            }
             /* No need for .client-content.sidebar-collapsed grid changes */

             .client-footer {
                 padding: 0 1rem; /* Consistent padding */
                 height: 70px; /* Slightly smaller footer */
                 --elpl-footer-height: 70px; /* Update variable */
             }
             .chat-input-container {
                 padding: 0.25rem; /* Tighter padding */
                 gap: 0.5rem; /* Reduce gap */
             }
              .send-button, .next-button { /* Smaller buttons */
                 width: 50px;
                 height: 50px;
             }
             .button-icon { /* Smaller icons */
                 width: 24px;
                 height: 24px;
             }
        }
        
        /* Added sr-only for accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

    </style>
</head>
<body>
    <div class="client-layout" data-client-component="merit-page"> <!-- Keep component hook -->
        <header class="client-header" role="banner">
            <div class="header-content">
                <!-- Add menu toggle for mobile? -->
                <img src="/clients/elpl/assets/images/client-elpl-logo-white.png" alt="EL Education Logo" class="logo" style="padding: 5px;">
                <div class="version-display" aria-label="Version and time">v1.0.0</div>
            </div>
        </header>

        <main class="client-content" role="main"> <!-- ID removed, class used -->
            <nav class="sidebar expanded" role="navigation" aria-label="Main navigation"> <!-- ID removed, class used -->
                <div class="sidebar-content">
                    <div class="sidebar-nav">
                        <a href="#welcome" class="nav-link active" data-section="welcome" aria-current="page">
                            <span class="nav-text">Welcome</span>
                        </a>
                        <a href="#chat" class="nav-link" data-section="chat">
                            <span class="nav-text">Chat</span>
                        </a>
                    </div>
                 </div>
            </nav>
             <!-- Moved toggle outside nav but inside main-content for positioning -->
             <button id="sidebarToggle" class="sidebar-toggle" aria-expanded="true" aria-label="Toggle Sidebar">
                 <span class="toggle-icon">◀</span> <!-- Icon indicates collapse -->
             </button>

            <div class="content-area" role="region" aria-label="Main content">
                <div class="section active" data-section="welcome" role="tabpanel" aria-labelledby="welcome-tab">
                    <form class="welcome-form" id="welcome-form">
                        <div class="form-group">
                            <label for="grade-level">What grade level do you teach?</label>
                            <div class="select-wrapper">
                                <select id="grade-level" class="form-control" required>
                                    <option value="">Select a grade level</option>
                                    <option value="elementary">Elementary (K-5)</option>
                                    <option value="middle">Middle School (6-8)</option>
                                    <option value="high">High School (9-12)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="curriculum">What curriculum do you use?</label>
                            <div class="select-wrapper">
                                <select id="curriculum" class="form-control" required>
                                    <option value="">Select your curriculum</option>
                                    <option value="ela" selected>English Language Arts (ELA)</option>
                                    <option value="crew">Crew</option>
                                    <option value="math">Mathematics</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="section" data-section="chat" role="tabpanel" aria-labelledby="chat-tab" hidden>
                    <!-- Chat interface content -->
                    <div class="chat-container">
                        <div class="messages" id="chat-messages"></div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="client-footer" role="contentinfo">
            <div class="footer-content">
                <div class="playbar" id="playbar"> <!-- Keep ID for JS -->
                    <button class="next-button" id="next-button" disabled aria-label="Continue to chat"> <!-- Keep ID for JS -->
                        <img src="/clients/elpl/assets/images/client-elpl-next-icon-white.svg" alt="Next" class="button-icon">
                    </button>
                </div>
                <div class="chatbar" id="chatbar" hidden> <!-- Keep ID for JS -->
                    <div class="chat-input-container">
                        <textarea class="chat-input" 
                                 id="chat-input" <!-- Keep ID for JS -->
                                 aria-label="Type your message"
                                 placeholder="Type your message..."
                                 rows="1"
                                 onkeypress="handleKeyPress(event)"></textarea> <!-- Added keypress handler -->
                        <button class="send-button" id="send-button" aria-label="Send message"> <!-- Keep ID for JS -->
                            <img src="/clients/elpl/assets/images/client-elpl-send-icon-white.svg" alt="Send" class="button-icon">
                        </button>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Merit specific scripts (order matters) -->
    <script type="module" src="assets/js/client-merit-form.js"></script>
    <script type="module" src="assets/js/client-merit-chat.js"></script>
    <script type="module" src="assets/js/client-merit-logic.js"></script> <!-- Logic likely depends on form/chat -->

</body>
</html> 